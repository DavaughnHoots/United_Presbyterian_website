<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="admin-header mb-4">
                <h1>Historical Contexts</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="HistoricalContextManager.showImportModal()">
                        <i class="fas fa-upload"></i> Import
                    </button>
                    <button class="btn btn-secondary" onclick="HistoricalContextManager.exportHistoricalContexts()">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-primary" onclick="HistoricalContextManager.showCreateModal()">
                        <i class="fas fa-plus"></i> Create New
                    </button>
                </div>
            </div>

            <!-- Filter and Search -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="Search historical contexts..." 
                                   onkeyup="HistoricalContextManager.filterHistoricalContexts()">
                        </div>
                        <div class="col-md-3">
                            <select class="form-control" id="timePeriodFilter" onchange="HistoricalContextManager.filterHistoricalContexts()">
                                <option value="">All Time Periods</option>
                                <option value="Ancient">Ancient</option>
                                <option value="Medieval">Medieval</option>
                                <option value="Reformation">Reformation</option>
                                <option value="Modern">Modern</option>
                                <option value="Contemporary">Contemporary</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-control" id="themeFilter" onchange="HistoricalContextManager.filterHistoricalContexts()">
                                <option value="">All Themes</option>
                                <option value="Faith">Faith</option>
                                <option value="Hope">Hope</option>
                                <option value="Love">Love</option>
                                <option value="Prayer">Prayer</option>
                                <option value="Worship">Worship</option>
                                <option value="Service">Service</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historical Contexts List -->
            <div class="content-grid" id="historicalContextsList">
                <% if (historicalContexts && historicalContexts.length > 0) { %>
                    <% historicalContexts.forEach(context => { %>
                        <div class="content-card" data-id="<%= context.id %>" 
                             data-title="<%= (context.title || '').toLowerCase() %>"
                             data-time-period="<%= context.metadata?.time_period || '' %>"
                             data-theme="<%= context.theme || '' %>">
                            <div class="content-card-header">
                                <h5><%= context.title %></h5>
                                <button class="btn btn-sm btn-link" onclick="HistoricalContextManager.editHistoricalContext('<%= context.id %>')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div class="content-card-body">
                                <% if (context.metadata?.time_period) { %>
                                    <p class="text-muted small mb-2">
                                        <i class="fas fa-clock"></i> <%= context.metadata.time_period %>
                                    </p>
                                <% } %>
                                <p class="content-preview">
                                    <%= context.content ? context.content.substring(0, 200) + '...' : 'No content' %>
                                </p>
                                <% if (context.metadata?.related_hymn || context.metadata?.biblical_reference) { %>
                                    <div class="mt-2">
                                        <% if (context.metadata.related_hymn) { %>
                                            <span class="badge badge-info"><i class="fas fa-music"></i> <%= context.metadata.related_hymn %></span>
                                        <% } %>
                                        <% if (context.metadata.biblical_reference) { %>
                                            <span class="badge badge-secondary"><i class="fas fa-bible"></i> <%= context.metadata.biblical_reference %></span>
                                        <% } %>
                                    </div>
                                <% } %>
                            </div>
                            <div class="content-card-footer">
                                <button class="btn btn-sm btn-outline-primary" onclick="HistoricalContextManager.previewHistoricalContext('<%= context.id %>')">
                                    Preview
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="HistoricalContextManager.deleteHistoricalContext('<%= context.id %>')">
                                    Delete
                                </button>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="col-12">
                        <div class="alert alert-info">
                            No historical contexts found. Click "Create New" to add your first historical context.
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade" id="historicalContextModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Create Historical Context</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="historicalContextForm">
                    <input type="hidden" id="contextId">
                    
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" class="form-control" id="contextTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Historical Narrative *</label>
                        <textarea class="form-control" id="contextContent" rows="8" required></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Time Period</label>
                                <input type="text" class="form-control" id="contextTimePeriod" 
                                       placeholder="e.g., 1st Century, Medieval, 1873">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Historical Figure</label>
                                <input type="text" class="form-control" id="contextFigure" 
                                       placeholder="e.g., King David, Martin Luther">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Related Hymn</label>
                                <input type="text" class="form-control" id="contextRelatedHymn" 
                                       placeholder="e.g., It Is Well With My Soul">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Biblical Reference</label>
                                <input type="text" class="form-control" id="contextBiblicalRef" 
                                       placeholder="e.g., Luke 8:22-25">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" class="form-control" id="contextLocation" 
                                       placeholder="e.g., Jerusalem, Sea of Galilee">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Theme</label>
                                <select class="form-control" id="contextTheme">
                                    <option value="">Select theme...</option>
                                    <option value="Faith">Faith</option>
                                    <option value="Hope">Hope</option>
                                    <option value="Love">Love</option>
                                    <option value="Prayer">Prayer</option>
                                    <option value="Worship">Worship</option>
                                    <option value="Service">Service</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Application Questions</label>
                        <textarea class="form-control" id="contextQuestions" rows="3" 
                                  placeholder="Enter reflection questions, one per line"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Tags</label>
                        <input type="text" class="form-control" id="contextTags" 
                               placeholder="Enter tags separated by commas">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="HistoricalContextManager.saveHistoricalContext()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Historical Contexts</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="event.preventDefault(); HistoricalContextManager.switchImportTab('paste')">Paste JSON</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="event.preventDefault(); HistoricalContextManager.switchImportTab('example')">Example Template</a>
                    </li>
                </ul>
                
                <div id="pasteImportContent" class="tab-content">
                    <div class="form-group">
                        <label>Paste JSON Data</label>
                        <textarea class="form-control" id="importData" rows="10" 
                                  placeholder='[{"title": "Historical Context Title", "content": "..."}]'></textarea>
                    </div>
                </div>
                
                <div id="exampleImportContent" class="tab-content hidden">
                    <div class="alert alert-info">
                        <h6>Example Historical Context JSON Format:</h6>
                        <pre><code>[
  {
    "title": "The Story Behind 'It Is Well With My Soul'",
    "content": "In 1873, Horatio Spafford faced unimaginable tragedy. After losing his son to scarlet fever and his business in the Great Chicago Fire, he sent his wife and four daughters ahead to Europe while he stayed to handle business matters. Their ship, the Ville du Havre, collided with another vessel and sank. His wife survived, but all four daughters perished. Upon receiving a telegram from his wife saying simply 'Saved alone,' Spafford immediately set sail to join her. As his ship passed near where his daughters had drowned, he penned the words to one of Christianity's most beloved hymns: 'When peace like a river attendeth my way, when sorrows like sea billows roll; whatever my lot, Thou hast taught me to say, It is well, it is well with my soul.'",
    "time_period": "1873",
    "figure": "Horatio Spafford",
    "related_hymn": "It Is Well With My Soul",
    "location": "Atlantic Ocean",
    "theme": "Faith",
    "questions": [
      "How can tragedy deepen our faith rather than destroy it?",
      "What does it mean to say 'it is well with my soul' in difficult times?"
    ],
    "tags": ["tragedy", "faith", "hymn story", "perseverance"]
  },
  {
    "title": "Jesus Calms the Storm",
    "content": "The Sea of Galilee, known for its sudden and violent storms, became the setting for one of Jesus' most dramatic miracles. As experienced fishermen, the disciples knew these waters well, yet they found themselves terrified as their boat was overwhelmed by waves. Meanwhile, Jesus slept peacefully in the stern. Their cry, 'Teacher, don't you care if we drown?' reveals both their desperation and their struggle to understand who Jesus truly was. When Jesus stood and commanded 'Quiet! Be still!' the wind died down completely. This miracle demonstrated His divine authority over creation itself, leaving the disciples to wonder, 'Who is this? Even the wind and waves obey him!'",
    "time_period": "1st Century AD",
    "biblical_reference": "Mark 4:35-41",
    "location": "Sea of Galilee",
    "theme": "Faith",
    "questions": [
      "What storms in your life need Jesus to speak peace?",
      "How does this story challenge your understanding of who Jesus is?"
    ],
    "tags": ["miracle", "faith", "Sea of Galilee", "storm"]
  }
]</code></pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="HistoricalContextManager.importHistoricalContexts()">Import</button>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Preview Historical Context</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="previewContent">
                <!-- Preview content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script src="/js/admin/historical-context-manager.js"></script>