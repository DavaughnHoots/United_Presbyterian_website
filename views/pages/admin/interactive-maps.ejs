<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="admin-header mb-4">
                <h1>Interactive Maps</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="InteractiveMapManager.showImportModal()">
                        <i class="fas fa-upload"></i> Import
                    </button>
                    <button class="btn btn-secondary" onclick="InteractiveMapManager.exportMaps()">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-primary" onclick="InteractiveMapManager.showCreateModal()">
                        <i class="fas fa-plus"></i> Create New
                    </button>
                </div>
            </div>

            <!-- Filter and Search -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="Search interactive maps..." 
                                   onkeyup="InteractiveMapManager.filterMaps()">
                        </div>
                        <div class="col-md-3">
                            <select class="form-control" id="regionFilter" onchange="InteractiveMapManager.filterMaps()">
                                <option value="">All Regions</option>
                                <option value="Israel/Palestine">Israel/Palestine</option>
                                <option value="Egypt">Egypt</option>
                                <option value="Jordan">Jordan</option>
                                <option value="Turkey">Turkey</option>
                                <option value="Greece">Greece</option>
                                <option value="Italy">Italy</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-control" id="periodFilter" onchange="InteractiveMapManager.filterMaps()">
                                <option value="">All Periods</option>
                                <option value="Old Testament">Old Testament</option>
                                <option value="New Testament">New Testament</option>
                                <option value="Early Church">Early Church</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Maps List -->
            <div class="content-grid" id="mapsList">
                <% if (maps && maps.length > 0) { %>
                    <% maps.forEach(map => { %>
                        <div class="content-card map-card" data-id="<%= map.id %>" 
                             data-title="<%= (map.title || '').toLowerCase() %>"
                             data-region="<%= map.metadata?.region || '' %>"
                             data-period="<%= map.metadata?.biblical_period || '' %>">
                            <div class="content-card-header">
                                <h5><%= map.title %></h5>
                                <button class="btn btn-sm btn-link" onclick="InteractiveMapManager.editMap('<%= map.id %>')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div class="content-card-body">
                                <% if (map.metadata?.region) { %>
                                    <p class="text-muted small mb-2">
                                        <i class="fas fa-globe"></i> <%= map.metadata.region %>
                                    </p>
                                <% } %>
                                <p class="content-preview">
                                    <%= map.content ? map.content.substring(0, 150) + '...' : 'No description' %>
                                </p>
                                <% if (map.metadata?.locations && Array.isArray(map.metadata.locations)) { %>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <i class="fas fa-map-marker-alt"></i> 
                                            <%= map.metadata.locations.length %> location<%= map.metadata.locations.length !== 1 ? 's' : '' %>
                                        </small>
                                    </div>
                                <% } %>
                                <% if (map.metadata?.biblical_events) { %>
                                    <div class="mt-2">
                                        <span class="badge badge-info"><i class="fas fa-book"></i> <%= map.metadata.biblical_events %></span>
                                    </div>
                                <% } %>
                            </div>
                            <div class="content-card-footer">
                                <button class="btn btn-sm btn-outline-primary" onclick="InteractiveMapManager.previewMap('<%= map.id %>')">
                                    Preview
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="InteractiveMapManager.deleteMap('<%= map.id %>')">
                                    Delete
                                </button>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="col-12">
                        <div class="alert alert-info">
                            No interactive maps found. Click "Create New" to add your first map.
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade" id="mapModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Create Interactive Map</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="mapForm">
                    <input type="hidden" id="mapId">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" class="form-control" id="mapTitle" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Description *</label>
                                <textarea class="form-control" id="mapContent" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Map URL (Google Maps embed or similar)</label>
                                <input type="url" class="form-control" id="mapUrl" 
                                       placeholder="https://www.google.com/maps/embed?...">
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Region</label>
                                        <select class="form-control" id="mapRegion">
                                            <option value="">Select region...</option>
                                            <option value="Israel/Palestine">Israel/Palestine</option>
                                            <option value="Egypt">Egypt</option>
                                            <option value="Jordan">Jordan</option>
                                            <option value="Turkey">Turkey</option>
                                            <option value="Greece">Greece</option>
                                            <option value="Italy">Italy</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Biblical Period</label>
                                        <select class="form-control" id="mapPeriod">
                                            <option value="">Select period...</option>
                                            <option value="Old Testament">Old Testament</option>
                                            <option value="New Testament">New Testament</option>
                                            <option value="Early Church">Early Church</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Biblical Events</label>
                                <input type="text" class="form-control" id="mapEvents" 
                                       placeholder="e.g., Jesus walks on water, Paul's missionary journey">
                            </div>
                            
                            <div class="form-group">
                                <label>Tags</label>
                                <input type="text" class="form-control" id="mapTags" 
                                       placeholder="Enter tags separated by commas">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Locations</label>
                                <div class="alert alert-info small">
                                    Add locations with their descriptions. These will be marked on the map.
                                </div>
                                <div id="locationsContainer">
                                    <!-- Location inputs will be added here -->
                                </div>
                                <button type="button" class="btn btn-sm btn-secondary" onclick="InteractiveMapManager.addLocationInput()">
                                    <i class="fas fa-plus"></i> Add Location
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label>Map Preview</label>
                                <div id="mapPreviewContainer" style="height: 300px; border: 1px solid #ddd; background: #f5f5f5;">
                                    <p class="text-center text-muted" style="padding-top: 140px;">
                                        Enter a map URL to see preview
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="InteractiveMapManager.saveMap()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Interactive Maps</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="event.preventDefault(); InteractiveMapManager.switchImportTab('paste')">Paste JSON</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="event.preventDefault(); InteractiveMapManager.switchImportTab('example')">Example Template</a>
                    </li>
                </ul>
                
                <div id="pasteImportContent" class="tab-content">
                    <div class="form-group">
                        <label>Paste JSON Data</label>
                        <textarea class="form-control" id="importData" rows="10" 
                                  placeholder='[{"title": "Map Title", "content": "..."}]'></textarea>
                    </div>
                </div>
                
                <div id="exampleImportContent" class="tab-content hidden">
                    <div class="alert alert-info">
                        <h6>Example Interactive Map JSON Format:</h6>
                        <pre><code>[
  {
    "title": "Sea of Galilee - Where Jesus Walked on Water",
    "content": "The Sea of Galilee, also known as Lake Gennesaret or Lake Tiberias, is a freshwater lake in Israel. It is the lowest freshwater lake on Earth and the second-lowest lake in the world. This was the setting for many of Jesus' miracles including walking on water, calming the storm, and the miraculous catch of fish.",
    "map_url": "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d215847.3748005237!2d35.449507!3d32.815632!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x151c4b9e2a2a2a2b%3A0x8e8c8c8c8c8c8c8c!2sSea+of+Galilee!5e0!3m2!1sen!2sus!4v1234567890",
    "region": "Israel/Palestine",
    "biblical_period": "New Testament",
    "biblical_events": "Jesus walks on water, Calms the storm, Calls the disciples",
    "locations": [
      {
        "name": "Capernaum",
        "description": "Jesus' home base during his Galilean ministry",
        "coordinates": "32.8806° N, 35.5751° E"
      },
      {
        "name": "Bethsaida",
        "description": "Home of Peter, Andrew, and Philip",
        "coordinates": "32.9097° N, 35.6298° E"
      },
      {
        "name": "Tiberias",
        "description": "Major city on the western shore",
        "coordinates": "32.7957° N, 35.5319° E"
      }
    ],
    "tags": ["miracles", "Jesus", "disciples", "Galilee"]
  },
  {
    "title": "Paul's First Missionary Journey",
    "content": "Paul's first missionary journey (Acts 13-14) took him from Antioch through Cyprus and into modern-day Turkey. This journey established the pattern for spreading the Gospel to the Gentiles and laid the foundation for many early churches.",
    "map_url": "https://example.com/pauls-journey-map",
    "region": "Turkey",
    "biblical_period": "New Testament",
    "biblical_events": "Paul's first missionary journey",
    "locations": [
      {
        "name": "Antioch",
        "description": "Starting point of the journey",
        "coordinates": "36.2028° N, 36.1605° E"
      },
      {
        "name": "Salamis",
        "description": "First stop in Cyprus",
        "coordinates": "35.1856° N, 33.9000° E"
      },
      {
        "name": "Paphos",
        "description": "Where Paul confronted the sorcerer",
        "coordinates": "34.7720° N, 32.4297° E"
      }
    ],
    "tags": ["Paul", "missionary", "early church", "Acts"]
  }
]</code></pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="InteractiveMapManager.importMaps()">Import</button>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Preview Interactive Map</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="previewContent">
                <!-- Preview content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<style>
.map-card {
    min-height: 220px;
}

.location-input-group {
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
}

.location-input-group .form-row {
    margin-bottom: 5px;
}

#mapPreviewContainer iframe {
    width: 100%;
    height: 100%;
    border: none;
}
</style>

<script src="/js/admin/interactive-map-manager.js"></script>